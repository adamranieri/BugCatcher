<!DOCTYPE html>
<html lang="en">
<head>
    <title>Defects</title>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.8/purify.min.js" integrity="sha512-M72KfQy4kPuLYC6CeTrN0eA17U1lXEMrr5qEJC/40CLdZGC3HpwPS0esQLqBHnxty2FIcuNdP9EqwSOCLEVJXQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<body>

   <h1 id="welcomeHeading"></h1>

   <div id="myDefects">

   </div>
    
    
</body>
<script>

    const welcome = document.getElementById("welcomeHeading");
    const myDefects = document.getElementById("myDefects");

    const user = JSON.parse(sessionStorage.getItem("user"));
    welcome.innerText = `Welcome ${user.username}`;

    async function getDefects(){
        const response = await fetch("http://127.0.0.1:8000/defects");
        const defects = await response.json(); 
        return defects;
    }

    
    function generateDefectDivs(defects){
        console.log(defects)
        return defects.map(d =>`

            <div>

                <h2>id: ${d.defectId}</h3>

                <h3>${d.desc} ${d.status}</h3> 
                <h4>${d.severity} ${d.priority}</h4>

                <p>
                ${d.stepsToReproduce}
                </p>

                <a href="defect-editor.html?id=${d.defectId}">modify</a>

            </div>

        `).join("");
    }

    async function renderTable(){
        console.log(user)
        const defects = await getDefects();
        const filteredDefects = defects.filter(d => d.assignedTo === user.username)
        const divHtml = generateDefectDivs(filteredDefects);
        myDefects.innerHTML = divHtml;
    }

    renderTable()


    
   



</script>
</html>