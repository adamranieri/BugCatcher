<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login Page</title>
</head>
<body>
    <h1>Login Page</h1>

    <form onsubmit="handleSubmission(event)">
    <fieldset>
        <legend>Login</legend>

        <label for="username">Username</label>
        <input name="username" type="text" placeholder="username" required/>
        <br/>
        <label for="pass">Password</label>
        <input name="pass" type="password"/>

        <button>Login</button>

    </fieldset>
</form>
</body>
<script>

    async function handleSubmission(event){
        event.preventDefault()
        const data = new FormData(event.target);
        const username = data.get("username");
        const password = data.get("pass");
        const loginFormJson = JSON.stringify({username,password});

        const options = {
            method:"PATCH", 
            body:loginFormJson, 
            headers:{
                "Content-Type":"application/json"
            }};
        
        const response = await fetch(`${window.location.origin}/login`, options);
        const employee = await response.json();
        window.sessionStorage.setItem("user", JSON.stringify(employee));

        if(employee.role === "Manager"){
            window.location = "home-manager.html";
        }else{
            window.location ="home-tester.html";
        }
        

    }

</script>
</html>